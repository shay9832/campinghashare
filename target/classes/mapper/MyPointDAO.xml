<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team.mvc.Interface.IMyPointDAO">
    <resultMap id="MyPointMap" type="com.team.mvc.DTO.MyPointDTO">
        <result property="created_date" column="created_date"/>
        <result property="point_reason" column="point_reason"/>
        <result property="point_change" column="point_change"/>
        <result property="total_point" column="total_point"/>
    </resultMap>

    <!-- 해당 회원의 포인트 내역을 조회 -->
    <select id="listMyPoint" resultType="com.team.mvc.DTO.MyPointDTO" resultMap="MyPointMap">
        SELECT
            PL.USER_CODE AS user_code,
            TO_CHAR(PL.CREATED_DATE, 'YYYY-MM-DD') AS created_date,
            PCT.POINT_CHANGE_TYPE_NAME AS point_reason,
            PL.POINT_CHANGE as point_change,
            SUM(PL.POINT_CHANGE) OVER (ORDER BY PL.CREATED_DATE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS total_point
        FROM POINT_LOG PL
                 JOIN POINT_CHANGE_TYPE PCT
                      ON PL.POINT_CHANGE_TYPE_ID = PCT.POINT_CHANGE_TYPE_ID
        WHERE USER_CODE = #{userCode}
        ORDER BY PL.CREATED_DATE DESC
    </select>


</mapper>