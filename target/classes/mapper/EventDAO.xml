<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team.mvc.Interface.IEventDAO">

    <!-- 전체 이벤트 리스트 조회 -->
    <select id="listEvent" parameterType="map" resultType="com.team.mvc.DTO.EventDTO">
        SELECT EVENT_ID AS eventId,
               ADMIN_ID as adminId,
               BOARD_ID as boardId,
               EVENT_TITLE as eventTitle,
               EVENT_CONTENT as eventContent,
               EVENT_START_DATE as eventStartDate,
               EVENT_END_DATE as eventEndDate,
               CREATED_DATE as createdDate
        FROM EVENT
        <where>
            <if test="status != null and status != ''">
                <choose>
                    <when test="status == 'going'">
                        AND EVENT_START_DATE &lt;= SYSDATE AND EVENT_END_DATE >= SYSDATE
                    </when>
                    <when test="status == 'coming'">
                        AND EVENT_START_DATE > SYSDATE
                    </when>
                    <when test="status == 'ended">
                        AND EVENT_END_DATE &lt; SYSDATE
                    </when>
                </choose>
            </if>
        </where>
    </select>


    <!-- 이벤트 개수 조회 -->
    <select id="countEvents" parameterType="map" resultType="int">
        SELECT COUNT(*)
        FROM EVENT
        <where>
            <if test="status != null and status != ''">
                <choose>
                    <when test="status == 'going'">
                        AND EVENT_START_DATE &lt;= SYSDATE AND EVENT_END_DATE >= SYSDATE
                    </when>
                    <when test="status == 'coming'">
                        AND EVENT_START_DATE > SYSDATE
                    </when>
                    <when test="status == 'ended">
                        AND EVENT_END_DATE &lt; SYSDATE
                    </when>
                </choose>
            </if>
            <if test="searchKeword != null and searchKeword != ''">
                <choose>
                    <when test="searchType == 'title'">
                        AND EVENT_TITLE LIKE '%' || #{searchKeword} || '%'
                    </when>
                    <when test="searchType == 'content'">
                        AND EVENT_CONTENT LIKE '%' || #{searchKeword} || '%'
                    </when>
                    <otherwise>
                        AND (EVENT_TITLE LIKE '%' || #{searchKeword} || '%' OR EVENT_CONTENT LIKE '%' || #{searchKeword} || '%')
                    </otherwise>
                </choose>
            </if>
        </where>
    </select>


</mapper>