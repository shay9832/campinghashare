<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team.mvc.Interface.IRegisterStorenDAO">

    <resultMap id="brand" type="com.team.mvc.DTO.RegisterStorenDTO">
        <result column="브랜드명" property="brandName"/>
        <result column="장비명" property="equipName"/>
    </resultMap>

    <select id="getList" parameterType="int" resultType="com.team.mvc.DTO.RegisterStorenDTO">
        SELECT
            er.EQUIP_CODE as equip_code,
            er.ORIGINAL_PRICE as original_price,
            parent.CATEGORY_NAME as majorCategory,
            child.CATEGORY_NAME as middleCategory,
            b.BRAND_NAME as brand,
            en.EQUIP_NAME as equip_name,
            en.EQUIP_NAME_ID as equip_name_id
        FROM
            EQUIPMENT_REGISTRATION er
                JOIN
            CATEGORY child ON er.CATEGORY_ID = child.CATEGORY_ID
                LEFT JOIN
            CATEGORY parent ON child.PARENT_CATEGORY_ID = parent.CATEGORY_ID
                JOIN
            EQUIP_NAME en ON er.EQUIP_NAME_ID = en.EQUIP_NAME_ID
                JOIN
            BRAND b ON en.BRAND_ID = b.BRAND_ID
        WHERE
            er.EQUIP_code = #{equip_code, jdbcType=INTEGER}
    </select>

    <select id="list" resultMap="brand">
        SELECT "브랜드명","장비명"
        FROM VW_BRAND_EQUIP_NAME
    </select>

    <!-- 특정 장비 조회 (equip_code 기준) -->
    <select id="getEquipInfo" parameterType="int" resultType="com.team.mvc.DTO.RegisterStorenDTO">
        SELECT
            er.EQUIP_CODE as equip_code,
            er.ORIGINAL_PRICE as original_price,
            parent.CATEGORY_NAME as majorCategory,
            child.CATEGORY_NAME as middleCategory,
            b.BRAND_NAME as brand,
            en.EQUIP_NAME as equip_name,
            en.EQUIP_NAME_ID as equip_name_id
        FROM
            EQUIPMENT_REGISTRATION er
                JOIN CATEGORY child ON er.CATEGORY_ID = child.CATEGORY_ID
                LEFT JOIN CATEGORY parent ON child.PARENT_CATEGORY_ID = parent.CATEGORY_ID
                JOIN EQUIP_NAME en ON er.EQUIP_NAME_ID = en.EQUIP_NAME_ID
                JOIN BRAND b ON en.BRAND_ID = b.BRAND_ID
        WHERE
            er.EQUIP_CODE = #{equip_code}
    </select>
</mapper>