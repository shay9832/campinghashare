<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team.mvc.Interface.IRegisterStorenDAO">

    <resultMap id="registerStorenResultMap" type="com.team.mvc.DTO.RegisterStorenDTO">
        <result column="EQUIP_CODE" property="equip_code"/>
        <result column="ORIGINAL_PRICE" property="original_price"/>
        <result column="MAJORCATEGORY" property="majorCategory"/>
        <result column="MIDDLECATEGORY" property="middleCategory"/>
        <result column="BRAND" property="brand"/>
        <result column="EQUIP_NAME" property="equip_name"/>
        <result column="EQUIP_NAME_ID" property="equip_name_id"/>
    </resultMap>

    <select id="list" resultMap="registerStorenResultMap">
        SELECT
            er.EQUIP_CODE AS EQUIP_CODE,
            er.ORIGINAL_PRICE AS ORIGINAL_PRICE,
            parent.CATEGORY_NAME AS MAJORCATEGORY,
            child.CATEGORY_NAME AS MIDDLECATEGORY,
            b.BRAND_NAME AS BRAND,
            en.EQUIP_NAME AS EQUIP_NAME,
            en.EQUIP_NAME_ID AS EQUIP_NAME_ID
        FROM EQUIPMENT_REGISTRATION er
                 JOIN CATEGORY child ON er.CATEGORY_ID = child.CATEGORY_ID
                 LEFT JOIN CATEGORY parent ON child.PARENT_CATEGORY_ID = parent.CATEGORY_ID
                 JOIN EQUIP_NAME en ON er.EQUIP_NAME_ID = en.EQUIP_NAME_ID
                 JOIN BRAND b ON en.BRAND_ID = b.BRAND_ID
    </select>

    <!-- 특정 장비 조회 (equip_code 기준) -->
    <select id="getEquipInfo" parameterType="int" resultMap="registerStorenResultMap">
        SELECT
            er.EQUIP_CODE AS EQUIP_CODE,
            er.ORIGINAL_PRICE AS ORIGINAL_PRICE,
            parent.CATEGORY_NAME AS MAJORCATEGORY,
            child.CATEGORY_NAME AS MIDDLECATEGORY,
            b.BRAND_NAME AS BRAND,
            en.EQUIP_NAME AS EQUIP_NAME,
            en.EQUIP_NAME_ID AS EQUIP_NAME_ID
        FROM EQUIPMENT_REGISTRATION er
                 JOIN CATEGORY child ON er.CATEGORY_ID = child.CATEGORY_ID
                 LEFT JOIN CATEGORY parent ON child.PARENT_CATEGORY_ID = parent.CATEGORY_ID
                 JOIN EQUIP_NAME en ON er.EQUIP_NAME_ID = en.EQUIP_NAME_ID
                 JOIN BRAND b ON en.BRAND_ID = b.BRAND_ID
        WHERE er.EQUIP_CODE = #{equip_code}
    </select>

</mapper>